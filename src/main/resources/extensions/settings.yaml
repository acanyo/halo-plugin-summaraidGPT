apiVersion: v1alpha1
kind: Setting
metadata:
  name: plugin-summaraidGPT-settings
spec:
  forms:
    - group: basic
      label: AI设置
      formSchema:
        - $el: a
          attrs:
            href: "https://docs.lik.cc"
            class: "py-4 block"
            target: "_blank"
            style:
              color: "#1890ff"
              fontSize: "0.875em"
              display: "flex"
              align-items: "center"
          children:
            - $el: span
              children: "查看 智阅GPT 帮助文档"
            - $el: img
              attrs:
                src: "/plugins/summaraidGPT/assets/static/img/link.svg"
                width: "14px"
                height: "14px"
                style:
                  margin-left: "4px"
        - $el: div
          attrs:
            class: formkit-actions
          children:
            - $el: script
              attrs:
                type: text/javascript
              children: |
                async function syncAllSummary() {
                  const btn = document.getElementById('syncAllSummaryBtn');
                  const btnText = document.getElementById('syncAllSummaryBtnText');
                  btn.disabled = true;
                  const oldText = btnText.textContent;
                  btnText.textContent = '同步中...';
                  try {
                    const response = await fetch('/apis/api.summary.summaraidgpt.lik.cc/v1alpha1/syncAll', {
                      method: 'POST',
                      headers: {
                        'Content-Type': 'application/json',
                      },
                    });
                    if (!response.ok) {
                      throw new Error('同步失败');
                    }
                    const result = await response.text();
                    alert(result || '同步成功！');
                  } catch (err) {
                    alert('同步失败：' + err.message);
                  } finally {
                    btn.disabled = false;
                    btnText.textContent = oldText;
                  }
                }
            - $el: button
              attrs:
                type: button
                id: syncAllSummaryBtn
                onclick: "syncAllSummary()"
                class: "btn-md btn-primary btn flex items-center gap-2"
              children:
                - $el: span
                  attrs:
                    id: syncAllSummaryBtnIcon
                    class: "hidden"
                - $el: span
                  attrs:
                    id: syncAllSummaryBtnText
                  children: 同步所有文章AI摘要
            - $el: div
              attrs:
                class: "formkit-help text-xs text-gray-500"
                style:
                  marginTop: "8px"
              children: "推荐使用国内加速站Codesphere，一个请求2s，其他都在15s左右"
        - $el: span
          children: "Halo交流群"
        - $el: div
          attrs:
            style:
              display: "flex"
              gap: "8px"
              marginTop: "8px"
          children:
            - $el: a
              attrs:
                href: "https://qm.qq.com/q/mPJeUOtG5G"
                target: "_blank"
                style:
                  color: "#1890ff"
                  fontSize: "0.875em"
                  padding: "4px 8px"
                  backgroundColor: "#f0f8ff"
                  borderRadius: "4px"
                  textDecoration: "none"
                  border: "1px solid #d1e7ff"
              children: "加入群聊 766203360"
            - $el: button
              attrs:
                type: "button"
                onclick: "navigator.clipboard.writeText('766203360').then(() => alert('群号已复制到剪贴板'))"
                style:
                  color: "#1890ff"
                  fontSize: "0.875em"
                  padding: "4px 8px"
                  backgroundColor: "#f0f8ff"
                  borderRadius: "4px"
                  border: "1px solid #d1e7ff"
                  cursor: "pointer"
              children: "复制群号"
        - $formkit: select
          name: globalAiType
          label: 全局AI类型
          placeholder: "选择默认使用的AI提供商"
          options:
            - label: OpenAI
              value: "openAi"
            - label: 智谱AI
              value: "zhipuAi"
            - label: 通义千问
              value: "dashScope"
            - label: Codesphere
              value: "codesphere"
          value: "openAi"
          help: "设置全局默认的AI提供商，当各功能模块AI类型为空时使用此配置"
        - $formkit: group
          name: aiModelConfig
          label: AI模型配置
          help: 说明：配置智阅GPT使用的AI模型提供商和相关参数
          value:
            openAiConfig:
              apiKey: ""
              modelName: "gpt-4o"
              baseUrl: "https://api.openai.com/"
            zhipuAiConfig:
              apiKey: ""
              modelName: "glm-4"
            dashScopeConfig:
              apiKey: ""
              modelName: "qwen-max"
            codesphereConfig:
              apiKey: ""
              modelName: "zhipu-free"
          children:
            - $formkit: group
              name: openAiConfig
              label: OpenAI 配置
              help: "配置OpenAI模型参数"
              children:
                - $formkit: password
                  name: apiKey
                  label: OpenAI API密钥
                  placeholder: "请输入OpenAI的API Key"
                  help: "必填，请前往 OpenAI 官网获取 API Key"
                - $formkit: select
                  name: modelName
                  label: 模型名称
                  searchable: true
                  allowCreate: true
                  placeholder: "请选择或输入模型名称"
                  options:
                    - label: gpt-4o
                      value: gpt-4o
                    - label: gpt-4o-mini
                      value: gpt-4o-mini
                    - label: gpt-4-turbo
                      value: gpt-4-turbo
                    - label: gpt-3.5-turbo
                      value: gpt-3.5-turbo
                  help: "选择或自定义模型名称"
                - $el: a
                  attrs:
                    href: "https://platform.openai.com/docs/models"
                    target: "_blank"
                    class: "text-blue-500 hover:text-blue-700 text-sm"
                  children: "查看 OpenAI 模型列表 ←"
                - $formkit: text
                  name: baseUrl
                  label: API地址
                  placeholder: "https://api.openai.com/"
                  help: "只需填写基础API地址，系统会自动拼接端点路径"

            - $formkit: group
              name: zhipuAiConfig
              label: 智谱AI 配置
              help: "配置智谱AI模型参数"
              children:
                - $formkit: password
                  name: apiKey
                  label: 智谱AI API密钥
                  placeholder: "请输入智谱AI的API Key"
                  help: "必填，请前往智谱AI官网获取API Key"
                - $formkit: select
                  name: modelName
                  label: 智谱AI 模型名称
                  searchable: true
                  allowCreate: true
                  placeholder: "请选择或输入模型名称"
                  options:
                    - label: GLM-4.5-Flash/免费
                      value: GLM-4.5-Flash
                    - label: GLM-4.5
                      value: GLM-4.5
                    - label: GLM-4.5-Air
                      value: GLM-4.5-Air
                  help: "选择或自定义智谱模型名称"
                - $el: a
                  attrs:
                    href: "https://open.bigmodel.cn/dev/api#language"
                    target: "_blank"
                    class: "text-blue-500 hover:text-blue-700 text-sm"
                  children: "查看 智谱AI 模型列表 ←"

            - $formkit: group
              name: dashScopeConfig
              label: 通义千问 配置
              help: "配置通义千问模型参数"
              children:
                - $formkit: password
                  name: apiKey
                  label: 通义千问 API密钥
                  placeholder: "请输入通义千问的API Key"
                  help: "必填，请前往阿里云获取通义千问API Key"
                - $formkit: select
                  name: modelName
                  label: 通义千问 模型名称
                  searchable: true
                  allowCreate: true
                  placeholder: "请选择或输入模型名称"
                  options:
                    - label: qwen-max
                      value: qwen-max
                    - label: qwen-plus
                      value: qwen-plus
                    - label: qwen-turbo
                      value: qwen-turbo
                  help: "选择或自定义通义千问模型名称"
                - $el: a
                  attrs:
                    href: "https://help.aliyun.com/zh/dashscope/developer-reference/model-introduction"
                    target: "_blank"
                    class: "text-blue-500 hover:text-blue-700 text-sm"
                  children: "查看 通义千问 模型列表 ←"
            - $formkit: group
              name: codesphereConfig
              label: Codesphere 配置
              help: "配置Codesphere加速站参数"
              children:
                - $formkit: password
                  name: apiKey
                  label: Codesphere API密钥
                  placeholder: "请输入Codesphere API Key"
                  help: "国内加速站，更快的响应速度"
                - $el: div
                  attrs:
                    class: "formkit-help text-xs text-gray-500"
                    innerHTML: "国内加速站 <a href='https://api.codesphere.chat/register?aff=76JI' title='前往 Codesphere 免费获取 Key' target='_blank' class='text-blue-500 hover:text-blue-700'>Codesphere 注册并获取专属免费 Key</a>，解锁更快的响应速度。"
                - $formkit: select
                  name: modelName
                  label: Codesphere 模型类型
                  searchable: true
                  allowCreate: true
                  placeholder: "请选择或输入模型类型"
                  options:
                    - label: glm-4-flash
                      value: glm-4-flash
                    - label: gpt-4o
                      value: gpt-4o
                    - label: gpt-4o-mini
                      value: gpt-4o-mini
                    - label: claude-3-5-sonnet
                      value: claude-3-5-sonnet
                  help: "推荐免费的智谱推理模型"
                - $el: a
                  attrs:
                    href: "https://api.codesphere.chat/pricing"
                    target: "_blank"
                    class: "text-blue-500 hover:text-blue-700 text-sm"
                  children: "查看 Codesphere 模型列表 ←"
                - $el: div
                  attrs:
                    class: "formkit-help text-xs text-gray-500"
                    innerHTML: "国内加速站，推荐免费的智谱推理模型"

    - group: summary
      label: 摘要设置
      formSchema:
        - $formkit: select
          name: summaryAiType
          label: 摘要AI类型选择
          placeholder: "选择用于摘要生成的AI提供商"
          options:
            - label: 使用主配置AI
              value: ""
            - label: OpenAI
              value: "openAi"
            - label: 智谱AI
              value: "zhipuAi"
            - label: 通义千问
              value: "dashScope"
            - label: Codesphere
              value: "codesphere"
          help: "选择专门用于摘要生成的AI提供商，留空则使用主配置"
          value: ""
        - $formkit: checkbox
          label: 是否启用文章摘要
          name: enable
          id: enable
          key: enable
          value: true
          help: "关闭后将不会注入摘要框"
        - $formkit: textarea
          name: summarySystemPrompt
          label: 摘要模型人设
          placeholder: "请输入摘要生成的模型人设"
          value: "你是一个专业的文章摘要总结助手，请根据文章内容生成简洁明了的摘要，字数控制在200字左右。"
          help: "专门用于摘要生成的AI人设，定义AI如何生成摘要"
        - $formkit: text
          label: 摘要框标题
          name: summaryTitle
          id: summaryTitle
          key: summaryTitle
          value: "文章摘要"
          help: "摘要框显示的标题"
        - $formkit: text
          label: AI模型名称
          name: gptName
          id: gptName
          key: gptName
          value: "智阅GPT"
          help: "AI模型名称，显示在摘要框中"

        - $formkit: text
          label: 深色模式选择器
          name: darkSelector
          id: darkSelector
          key: darkSelector
          value: "data-theme=dark"
          help: "用于自动判断深色模式的选择器"
        - $formkit: number
          label: 打字机速度
          name: typeSpeed
          id: typeSpeed
          key: typeSpeed
          value: 20
          help: "打字机动画速度（毫秒/字符）"
        - $formkit: checkbox
          label: 启用打字机效果
          name: typewriter
          id: typewriter
          key: typewriter
          value: true
          help: "是否启用打字机效果"
    - group: style
      label: 摘要框样式设置
      formSchema:
        - $formkit: select
          name: themeName
          key: themeName
          id: themeName
          label: 主题选择
          value: "custom"
          placeholder: "请选择主题"
          options:
            - label: 自定义主题
              value: custom
            - label: 蓝色主题
              value: blue
            - label: 默认主题
              value: default
            - label: 暗色主题
              value: dark
            - label: 绿色主题
              value: green
          help: "选择主题类型，自定义主题使用下方配色设置"
        - $formkit: attachment
          label: Logo图片
          name: logo
          id: logo
          key: logo
          value: "/plugins/summaraidGPT/assets/static/icon.svg"
          help: "摘要框Logo图片路径"
        - $formkit: text
          label: 背景色
          if: $get(themeName).value == "custom"
          name: themeBg
          id: themeBg
          key: themeBg
          value: "#f7f9fe"
        - $el: div
          if: $get(themeName).value == "custom"
          attrs:
            class: "formkit-help text-xs text-gray-500"
            innerHTML: "摘要框背景色，支持纯色和渐变色，如：linear-gradient(45deg, #f7f9fe, #e3e8f7)<a href='https://pxlab.cn/color/index.html' title='前往获取渐变色' target='_blank' class='text-blue-500 hover:text-blue-700'>获取渐变色</a>"
        - $formkit: color
          label: 主色调
          if: $get(themeName).value == "custom"
          name: themeMain
          id: themeMain
          key: themeMain
          value: "#4F8DFD"
          help: "主色调，用于边框和强调"
        - $formkit: color
          label: 标题颜色
          if: $get(themeName).value == "custom"
          name: themeTitle
          id: themeTitle
          key: themeTitle
          value: "#3A5A8C"
          help: "标题文字颜色"
        - $formkit: color
          label: 内容颜色
          if: $get(themeName).value == "custom"
          name: themeContent
          id: themeContent
          key: themeContent
          value: "#222"
          help: "内容文字颜色"
        - $formkit: color
          label: AI名称颜色
          if: $get(themeName).value == "custom"
          name: themeGptName
          id: themeGptName
          key: themeGptName
          value: "#7B88A8"
          help: "AI模型名称颜色"
        - $formkit: color
          label: 内容背景色
          if: $get(themeName).value == "custom"
          name: themeContentBg
          id: themeContentBg
          key: themeContentBg
          value: "#fff"
          help: "内容区域背景色"
        - $formkit: color
          label: 边框颜色
          if: $get(themeName).value == "custom"
          name: themeBorder
          id: themeBorder
          key: themeBorder
          value: "#e3e8f7"
          help: "边框颜色"
        - $formkit: text
          label: 阴影效果
          if: $get(themeName).value == "custom"
          name: themeShadow
          id: themeShadow
          key: themeShadow
          value: "0 2px 12px 0 rgba(60,80,180,0.08)"
          help: "阴影效果CSS值"
        - $formkit: color
          label: 标签背景色
          if: $get(themeName).value == "custom"
          name: themeTagBg
          id: themeTagBg
          key: themeTagBg
          value: "#f0f4ff"
          help: "标签背景色"
        - $formkit: color
          label: 标签文字颜色
          if: $get(themeName).value == "custom"
          name: themeTagColor
          id: themeTagColor
          key: themeTagColor
          value: "#4F8DFD"
          help: "标签文字颜色"
        - $formkit: color
          label: 光标颜色
          if: $get(themeName).value == "custom"
          name: themeCursor
          id: themeCursor
          key: themeCursor
          value: "#4F8DFD"
          help: "打字机光标颜色"
        - $formkit: text
          label: 内容字体大小
          if: $get(themeName).value == "custom"
          name: themeContentFontSize
          id: themeContentFontSize
          key: themeContentFontSize
          value: "16px"
          help: "内容文字字体大小"
        
    - group: tags
      label: 标签生成设置
      formSchema:
        - $formkit: select
          name: tagAiType
          label: 标签AI类型选择
          placeholder: "选择用于标签生成的AI提供商"
          options:
            - label: 使用主配置AI
              value: ""
            - label: OpenAI
              value: "openAi"
            - label: 智谱AI
              value: "zhipuAi"
            - label: 通义千问
              value: "dashScope"
            - label: Codesphere
              value: "codesphere"
          help: "选择专门用于标签生成的AI提供商，留空则使用主配置"
          value: ""
        - $formkit: textarea
          label: 标签生成角色设定
          name: tagGenerationPrompt
          id: tagGenerationPrompt
          key: tagGenerationPrompt
          value: "你是一个专业的标签生成助手，请根据文章内容生成相关的标签。标签应该准确反映文章主题，包含核心关键词，适合SEO优化，标签尽量控制在2-4字，用中文表达。"
          help: "AI标签生成的角色设定和指令"
        - $formkit: number
          label: 标签生成数量
          name: tagGenerationCount
          id: tagGenerationCount
          key: tagGenerationCount
          value: 6
          min: 1
          max: 5
          help: "每篇文章生成的标签数量"
          
    - group: assistant
      label: 文章助手设置
      formSchema:
        - $formkit: select
          name: assistantAiType
          label: 对话AI类型选择
          placeholder: "选择用于对话的AI提供商"
          options:
            - label: 使用主配置AI
              value: ""
            - label: OpenAI
              value: "openAi"
            - label: 智谱AI
              value: "zhipuAi"
            - label: 通义千问
              value: "dashScope"
            - label: Codesphere
              value: "codesphere"
          help: "选择专门用于对话的AI提供商，留空则使用主配置"
          value: ""
        - $el: div
          attrs:
            class: "formkit-help text-xs text-gray-500"
            style:
              marginTop: "8px"
          children: "⚠️ 注意：Codesphere免费模型（如glm-4-flash）暂时不支持多轮对话功能，如使用免费模型请更改为其他AI提供商。付费模型（如gpt-4o、claude-3-5-sonnet）支持对话功能。"
        - $formkit: attachment
          label: 对话框图标
          name: assistantIcon
          id: assistantIcon
          key: assistantIcon
          value: "/plugins/summaraidGPT/assets/static/icon.svg"
          help: "文章助手对话框的图标"
        - $formkit: textarea
          label: 对话助手人设
          name: conversationSystemPrompt
          id: conversationSystemPrompt
          key: conversationSystemPrompt
          value: "你是一个专业的文章助手AI，能够基于文章内容为用户提供深入的解答和讨论。请保持友好、专业的态度，提供准确、有用的信息。回答要简洁明了，重点突出。\n\n当有人问你是谁或什么模型时，请统一回答：我是Handsome开发的智阅GPT AI助手。"
          help: "多轮对话功能的AI人设，定义AI助手的角色和回答风格"
        - $formkit: text
          label: 对话框助手名称
          name: assistantName
          id: assistantName
          key: assistantName
          value: "智阅GPT助手"
          help: "对话框中显示的AI助手名称"
        - $formkit: text
          label: 输入框默认值
          name: inputPlaceholder
          id: inputPlaceholder
          key: inputPlaceholder
          value: "请输入您想了解的问题..."
          help: "输入框的默认提示文字"
        - $formkit: select
          label: 弹窗样式
          name: dialogType
          id: dialogType
          key: dialogType
          value: "overlay"
          options:
            - label: 默认全屏
              value: overlay
            - label: 默认弹窗
              value: modal
          help: "选择对话框的弹出样式"
        - $formkit: select
          label: 按钮位置
          name: buttonPosition
          id: buttonPosition
          key: buttonPosition
          value: "right"
          options:
            - label: 左侧
              value: left
            - label: 右侧
              value: right
          help: "文章助手按钮的显示位置"
        
    - group: polish
      label: 文章润色设置
      formSchema:
        - $formkit: select
          name: polishAiType
          label: 润色AI类型选择
          placeholder: "选择用于文章润色的AI提供商"
          options:
            - label: 使用主配置AI
              value: ""
            - label: OpenAI
              value: "openAi"
            - label: 智谱AI
              value: "zhipuAi"
            - label: 通义千问
              value: "dashScope"
            - label: Codesphere
              value: "codesphere"
          help: "选择专门用于文章润色的AI提供商，留空则使用主配置"
          value: ""
        - $formkit: textarea
          name: polishSystemPrompt
          label: 润色角色设定
          placeholder: "请输入文章润色的AI角色设定"
          value: "你是一个专业的文章润色助手，专门帮助用户改善文章的语言表达和流畅性。请遵循以下要求：\n1. 保持原文的核心意思和结构不变\n2. 改善语言表达，使其更加流畅自然\n3. 修正语法错误和用词不当\n4. 提升文章的可读性和专业性\n5. 保持原文的语言风格（正式/非正式）\n6. 直接返回润色后的内容，不要添加任何解释说明"
          help: "定义AI如何进行文章润色的角色设定和指令"
        - $formkit: number
          name: polishMaxLength
          label: 最大润色长度
          value: 2000
          min: 100
          max: 8000
          help: "单次润色的最大字符数，超过此长度将提示用户分段润色"

    - group: generate
      label: 文章生成设置
      formSchema:
        - $formkit: select
          name: generateAiType
          label: 生成AI类型选择
          placeholder: "选择用于文章生成的AI提供商"
          options:
            - label: 使用主配置AI
              value: ""
            - label: OpenAI
              value: "openAi"
            - label: 智谱AI
              value: "zhipuAi"
            - label: 通义千问
              value: "dashScope"
            - label: Codesphere
              value: "codesphere"
          help: "选择专门用于文章生成的AI提供商，留空则使用主配置"
          value: ""
        - $formkit: textarea
          name: generateSystemPrompt
          label: 文章生成角色设定
          placeholder: "请输入文章生成的AI角色设定"
          value: "你是一个专业的文章创作助手，能够根据用户的需求和主题生成高质量的文章内容。请遵循以下要求：\n1. 根据用户提供的主题和要求生成结构清晰的文章\n2. 文章内容要有逻辑性和可读性\n3. 语言表达要自然流畅，符合中文写作习惯\n4. 适当使用段落和标题来组织内容\n5. 确保文章内容原创且有意义\n6. 根据用户指定的长度要求控制文章篇幅\n7.你需要充分考虑SE0最佳实践，包括关键词优化、结构优化等"
          help: "定义AI如何进行文章生成的角色设定和指令"
    - group: title
      label: 标题生成设置
      formSchema:
        - $formkit: select
          name: titleAiType
          label: 标题生成AI类型选择
          placeholder: "选择用于标题生成的AI提供商"
          options:
            - label: 使用主配置AI
              value: ""
            - label: OpenAI
              value: "openAi"
            - label: 智谱AI
              value: "zhipuAi"
            - label: 通义千问
              value: "dashScope"
            - label: Codesphere
              value: "codesphere"
          help: "选择专门用于标题生成的AI提供商，留空则使用主配置"
          value: ""
        - $formkit: textarea
          name: titleSystemPrompt
          label: 标题生成角色设定
          placeholder: "请输入标题生成的AI角色设定"
          value: "你是一个专业的标题创作助手，能够根据文章内容生成吸引人的标题。请遵循以下要求：\n1. 根据文章内容的核心主题和关键信息生成标题\n2. 标题要简洁有力，能够吸引读者注意\n3. 标题要准确反映文章内容，避免标题党\n4. 考虑SEO优化，包含相关关键词\n5. 标题长度适中，一般控制在10-30个字符\n6. 可以生成多个不同风格的标题供选择\n7. 标题要有创意和吸引力，但保持真实性"
          help: "定义AI如何进行标题生成的角色设定和指令"
        - $formkit: number
          name: titleDefaultCount
          label: 默认生成标题数量
          placeholder: "请输入默认生成的标题数量"
          value: 5
          min: 1
          max: 20
          help: "设置默认生成多少个标题供用户选择"
        